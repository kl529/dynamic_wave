'use client'

import { DongpaConfig, MarketData, DongpaTrade, TodaySignal } from '@/types';

export class DongpaEngine {
  private config: DongpaConfig;
  private fees = {
    commission: 0.00044, // 0.044% ê±°ë˜ ìˆ˜ìˆ˜ë£Œ
    secFee: 0.0000278    // SEC ìˆ˜ìˆ˜ë£Œ 0.00278%
  };

  constructor(config: DongpaConfig) {
    this.config = config;
  }

  // ì´ ìˆ˜ìˆ˜ë£Œìœ¨ (í¸ë„)
  private get totalFeeRate(): number {
    return this.fees.commission + this.fees.secFee; // 0.047%
  }

  // ëª¨ë“œë³„ ì„¤ì •
  private getModeConfig(mode: 'safe' | 'aggressive') {
    const configs = {
      safe: {
        sellTarget: 0.002,    // 0.2% ìˆ˜ìµì—ì„œ ë§¤ë„
        buyTarget: 0.03,      // 3.0% í•˜ë½ì—ì„œ ë§¤ìˆ˜
        profitReinvest: 0.8,  // ì´ìµë³µë¦¬ 80%
        lossReinvest: 0.3     // ì†ì‹¤ë³µë¦¬ 30%
      },
      aggressive: {
        sellTarget: 0.025,    // 2.5% ìˆ˜ìµì—ì„œ ë§¤ë„
        buyTarget: 0.05,      // 5.0% í•˜ë½ì—ì„œ ë§¤ìˆ˜
        profitReinvest: 0.8,  // ì´ìµë³µë¦¬ 80%
        lossReinvest: 0.3     // ì†ì‹¤ë³µë¦¬ 30%
      }
    };
    
    return configs[mode];
  }

  // ì˜¤ëŠ˜ ë§¤ìˆ˜ ì‹ í˜¸ ê³„ì‚°
  public getTodayBuySignal(config: {
    ì´ˆê¸°ìê¸ˆ: number;
    ë¶„í• íšŸìˆ˜: number;
    ë§¤ë§¤ëª¨ë“œ: 'safe' | 'aggressive';
    í˜„ì¬ê°€: number;
    ë³€ë™ë¥ : number;
    ì˜ˆìˆ˜ê¸ˆ: number;
  }): {
    ì‹ í˜¸: 'BUY' | 'HOLD';
    ë§¤ìˆ˜ëŸ‰: number;
    ë§¤ìˆ˜ê°€: number;
    ë§¤ìˆ˜ê¸ˆì•¡: number;
    ìˆ˜ìˆ˜ë£Œ: number;
    ë‹¤ìŒë§¤ìˆ˜ê°€: number;
    ë©”ì‹œì§€: string;
  } {
    const { ì´ˆê¸°ìê¸ˆ, ë¶„í• íšŸìˆ˜, ë§¤ë§¤ëª¨ë“œ, í˜„ì¬ê°€, ë³€ë™ë¥ , ì˜ˆìˆ˜ê¸ˆ } = config;
    const modeConfig = this.getModeConfig(ë§¤ë§¤ëª¨ë“œ);
    
    // ë§¤ìˆ˜ ì¡°ê±´: ëª©í‘œ í•˜ë½ë¥  ì´ìƒ && í•˜ë½ && ì¶©ë¶„í•œ í˜„ê¸ˆ
    const ë§¤ìˆ˜ì¡°ê±´ì¶©ì¡± = Math.abs(ë³€ë™ë¥ ) >= modeConfig.buyTarget * 100 && 
                      ë³€ë™ë¥  < 0;
    
    // ë¶„í• ê¸ˆì•¡ ê³„ì‚°
    const ë¶„í• ê¸ˆì•¡ = ì´ˆê¸°ìê¸ˆ / ë¶„í• íšŸìˆ˜;
    const ë‹¤ìŒë§¤ìˆ˜ê°€ = í˜„ì¬ê°€ * (1 - modeConfig.buyTarget);
    
    if (ë§¤ìˆ˜ì¡°ê±´ì¶©ì¡± && ì˜ˆìˆ˜ê¸ˆ >= ë¶„í• ê¸ˆì•¡) {
      const ë§¤ìˆ˜ëŸ‰ = Math.floor(ë¶„í• ê¸ˆì•¡ / í˜„ì¬ê°€);
      const ë§¤ìˆ˜ê¸ˆì•¡ = ë§¤ìˆ˜ëŸ‰ * í˜„ì¬ê°€;
      const ìˆ˜ìˆ˜ë£Œ = ë§¤ìˆ˜ê¸ˆì•¡ * this.totalFeeRate;
      
      return {
        ì‹ í˜¸: 'BUY',
        ë§¤ìˆ˜ëŸ‰,
        ë§¤ìˆ˜ê°€: í˜„ì¬ê°€,
        ë§¤ìˆ˜ê¸ˆì•¡,
        ìˆ˜ìˆ˜ë£Œ,
        ë‹¤ìŒë§¤ìˆ˜ê°€,
        ë©”ì‹œì§€: `ğŸš€ ${ë§¤ìˆ˜ëŸ‰}ì£¼ ë§¤ìˆ˜ ì‹ í˜¸! @$${í˜„ì¬ê°€.toFixed(2)} (ë³€ë™ë¥ : ${ë³€ë™ë¥ .toFixed(2)}%)`
      };
    }
    
    return {
      ì‹ í˜¸: 'HOLD',
      ë§¤ìˆ˜ëŸ‰: 0,
      ë§¤ìˆ˜ê°€: 0,
      ë§¤ìˆ˜ê¸ˆì•¡: 0,
      ìˆ˜ìˆ˜ë£Œ: 0,
      ë‹¤ìŒë§¤ìˆ˜ê°€,
      ë©”ì‹œì§€: `$${ë‹¤ìŒë§¤ìˆ˜ê°€.toFixed(2)} ì´í•˜ ì‹œ ë§¤ìˆ˜ (${modeConfig.buyTarget * 100}% í•˜ë½ í•„ìš”)`
    };
  }

  // ì˜¤ëŠ˜ ë§¤ë„ ì‹ í˜¸ ê³„ì‚°
  public getTodaySellSignal(config: {
    ë§¤ë§¤ëª¨ë“œ: 'safe' | 'aggressive';
    í˜„ì¬ê°€: number;
    í‰ë‹¨ê°€: number;
    ë³´ìœ ëŸ‰: number;
  }): {
    ì‹ í˜¸: 'SELL' | 'HOLD' | 'NO_POSITION';
    ë§¤ë„ëŸ‰: number;
    ë§¤ë„ê°€: number;
    ë§¤ë„ê¸ˆì•¡: number;
    ìˆ˜ìˆ˜ë£Œ: number;
    ì˜ˆìƒìˆ˜ìµ: number;
    ëª©í‘œê°€: number;
    í•„ìš”ìƒìŠ¹ë¥ : number;
    ë©”ì‹œì§€: string;
  } {
    const { ë§¤ë§¤ëª¨ë“œ, í˜„ì¬ê°€, í‰ë‹¨ê°€, ë³´ìœ ëŸ‰ } = config;
    const modeConfig = this.getModeConfig(ë§¤ë§¤ëª¨ë“œ);
    
    if (ë³´ìœ ëŸ‰ === 0 || í‰ë‹¨ê°€ === 0) {
      return {
        ì‹ í˜¸: 'NO_POSITION',
        ë§¤ë„ëŸ‰: 0,
        ë§¤ë„ê°€: 0,
        ë§¤ë„ê¸ˆì•¡: 0,
        ìˆ˜ìˆ˜ë£Œ: 0,
        ì˜ˆìƒìˆ˜ìµ: 0,
        ëª©í‘œê°€: 0,
        í•„ìš”ìƒìŠ¹ë¥ : 0,
        ë©”ì‹œì§€: 'ë³´ìœ  ì¢…ëª© ì—†ìŒ'
      };
    }
    
    const ëª©í‘œê°€ = í‰ë‹¨ê°€ * (1 + modeConfig.sellTarget);
    const í•„ìš”ìƒìŠ¹ë¥  = ((ëª©í‘œê°€ - í˜„ì¬ê°€) / í˜„ì¬ê°€) * 100;
    
    if (í˜„ì¬ê°€ >= ëª©í‘œê°€) {
      const ë§¤ë„ê¸ˆì•¡ = ë³´ìœ ëŸ‰ * í˜„ì¬ê°€;
      const ìˆ˜ìˆ˜ë£Œ = ë§¤ë„ê¸ˆì•¡ * this.totalFeeRate;
      const ë§¤ìˆ˜ì›ê°€ = ë³´ìœ ëŸ‰ * í‰ë‹¨ê°€;
      const ì˜ˆìƒìˆ˜ìµ = ë§¤ë„ê¸ˆì•¡ - ë§¤ìˆ˜ì›ê°€ - ìˆ˜ìˆ˜ë£Œ;
      
      return {
        ì‹ í˜¸: 'SELL',
        ë§¤ë„ëŸ‰: ë³´ìœ ëŸ‰,
        ë§¤ë„ê°€: í˜„ì¬ê°€,
        ë§¤ë„ê¸ˆì•¡,
        ìˆ˜ìˆ˜ë£Œ,
        ì˜ˆìƒìˆ˜ìµ,
        ëª©í‘œê°€,
        í•„ìš”ìƒìŠ¹ë¥ : 0,
        ë©”ì‹œì§€: `ğŸ’° ${ë³´ìœ ëŸ‰}ì£¼ ì „ëŸ‰ ë§¤ë„! ì˜ˆìƒìˆ˜ìµ: $${ì˜ˆìƒìˆ˜ìµ.toFixed(2)} (${((ì˜ˆìƒìˆ˜ìµ / ë§¤ìˆ˜ì›ê°€) * 100).toFixed(2)}%)`
      };
    }
    
    return {
      ì‹ í˜¸: 'HOLD',
      ë§¤ë„ëŸ‰: 0,
      ë§¤ë„ê°€: 0,
      ë§¤ë„ê¸ˆì•¡: 0,
      ìˆ˜ìˆ˜ë£Œ: 0,
      ì˜ˆìƒìˆ˜ìµ: 0,
      ëª©í‘œê°€,
      í•„ìš”ìƒìŠ¹ë¥ ,
      ë©”ì‹œì§€: `$${ëª©í‘œê°€.toFixed(2)} ë„ë‹¬ ì‹œ ë§¤ë„ (${í•„ìš”ìƒìŠ¹ë¥ .toFixed(2)}% ìƒìŠ¹ í•„ìš”)`
    };
  }

  // ì¼ë³„ ë§¤ë§¤ ê¸°ë¡ ìƒì„± (ì—‘ì…€ ë¡œì§ ì™„ì „ êµ¬í˜„)
  public generateDailyTradeRecord(config: {
    ê±°ë˜ì¼ì: string;
    ì¢…ê°€: number;
    ë§¤ë§¤ëª¨ë“œ: 'safe' | 'aggressive';
    ì´ì „ê¸°ë¡?: DongpaTrade | null;
    ì´ˆê¸°ìê¸ˆ: number;
    ë¶„í• íšŸìˆ˜: number;
    ê°±ì‹ ì£¼ê¸°: number; // ê¸°ë³¸ 10ì¼
  }): DongpaTrade {
    const {
      ê±°ë˜ì¼ì, ì¢…ê°€, ë§¤ë§¤ëª¨ë“œ, ì´ì „ê¸°ë¡, 
      ì´ˆê¸°ìê¸ˆ, ë¶„í• íšŸìˆ˜, ê°±ì‹ ì£¼ê¸° = 10
    } = config;
    
    const modeConfig = this.getModeConfig(ë§¤ë§¤ëª¨ë“œ);
    
    // ì „ì¼ ëŒ€ë¹„ ë³€ë™ë¥  ê³„ì‚°
    const ë³€ë™ë¥  = ì´ì „ê¸°ë¡ ? 
      (ì¢…ê°€ - ì´ì „ê¸°ë¡.ì¢…ê°€) / ì´ì „ê¸°ë¡.ì¢…ê°€ * 100 : 0;
    
    // ìê¸ˆ ê°±ì‹  ì²´í¬ (ê°±ì‹ ì£¼ê¸°ì¼ë§ˆë‹¤)
    const ê±°ë˜ì¼ìˆ˜ = ì´ì „ê¸°ë¡ ? this.getBusinessDaysDiff(ì´ì „ê¸°ë¡.ê±°ë˜ì¼ì, ê±°ë˜ì¼ì) : 0;
    const ìê¸ˆê°±ì‹  = ê±°ë˜ì¼ìˆ˜ > 0 && ê±°ë˜ì¼ìˆ˜ % ê°±ì‹ ì£¼ê¸° === 0;
    
    // í˜„ì¬ ì‹œë“œ ê³„ì‚°
    let í˜„ì¬ì‹œë“œ = ì´ˆê¸°ìê¸ˆ;
    if (ì´ì „ê¸°ë¡) {
      í˜„ì¬ì‹œë“œ = ìê¸ˆê°±ì‹  ? ì´ˆê¸°ìê¸ˆ + ì´ì „ê¸°ë¡.ëˆ„ì ì†ìµ : ì´ì „ê¸°ë¡.ì‹œë“œ;
    }
    
    const ë§¤ìˆ˜ì˜ˆì • = í˜„ì¬ì‹œë“œ / ë¶„í• íšŸìˆ˜;
    const LOCë§¤ìˆ˜ëª©í‘œ = ì¢…ê°€ * (1 - modeConfig.buyTarget);
    const ëª©í‘œëŸ‰ = Math.floor(ë§¤ìˆ˜ì˜ˆì • / ì¢…ê°€);
    
    // í˜„ì¬ í¬íŠ¸í´ë¦¬ì˜¤ ìƒíƒœ
    const í˜„ì¬ì˜ˆìˆ˜ê¸ˆ = ì´ì „ê¸°ë¡?.ì˜ˆìˆ˜ê¸ˆ || ì´ˆê¸°ìê¸ˆ;
    const í˜„ì¬ë³´ìœ ëŸ‰ = ì´ì „ê¸°ë¡?.ë³´ìœ ëŸ‰ || 0;
    const í˜„ì¬í‰ë‹¨ê°€ = ì´ì „ê¸°ë¡?.í‰ë‹¨ê°€ || 0;
    
    // ë§¤ìˆ˜ ì‹ í˜¸ ì²´í¬
    const ë§¤ìˆ˜ì‹ í˜¸ = this.getTodayBuySignal({
      ì´ˆê¸°ìê¸ˆ: í˜„ì¬ì‹œë“œ,
      ë¶„í• íšŸìˆ˜,
      ë§¤ë§¤ëª¨ë“œ,
      í˜„ì¬ê°€: ì¢…ê°€,
      ë³€ë™ë¥ ,
      ì˜ˆìˆ˜ê¸ˆ: í˜„ì¬ì˜ˆìˆ˜ê¸ˆ
    });
    
    // ë§¤ë„ ì‹ í˜¸ ì²´í¬
    const ë§¤ë„ì‹ í˜¸ = this.getTodaySellSignal({
      ë§¤ë§¤ëª¨ë“œ,
      í˜„ì¬ê°€: ì¢…ê°€,
      í‰ë‹¨ê°€: í˜„ì¬í‰ë‹¨ê°€,
      ë³´ìœ ëŸ‰: í˜„ì¬ë³´ìœ ëŸ‰
    });
    
    // ê±°ë˜ ì‹¤í–‰
    let ë§¤ìˆ˜ê°€ = 0, ë§¤ìˆ˜ëŸ‰ = 0, ë§¤ìˆ˜ê¸ˆì•¡ = 0, ë§¤ìˆ˜ìˆ˜ìˆ˜ë£Œ = 0;
    let ë§¤ë„ì¼ = '', ë§¤ë„ê°€ = 0, ë§¤ë„ëŸ‰ = 0, ë§¤ë„ê¸ˆì•¡ = 0, ë§¤ë„ìˆ˜ìˆ˜ë£Œ = 0;
    let ë‹¹ì¼ì‹¤í˜„ì†ìµê¸ˆì•¡ = 0, ì†ìµë¥  = 0;
    
    // ë§¤ìˆ˜ ì‹¤í–‰
    if (ë§¤ìˆ˜ì‹ í˜¸.ì‹ í˜¸ === 'BUY') {
      ë§¤ìˆ˜ê°€ = ë§¤ìˆ˜ì‹ í˜¸.ë§¤ìˆ˜ê°€;
      ë§¤ìˆ˜ëŸ‰ = ë§¤ìˆ˜ì‹ í˜¸.ë§¤ìˆ˜ëŸ‰;
      ë§¤ìˆ˜ê¸ˆì•¡ = ë§¤ìˆ˜ì‹ í˜¸.ë§¤ìˆ˜ê¸ˆì•¡;
      ë§¤ìˆ˜ìˆ˜ìˆ˜ë£Œ = ë§¤ìˆ˜ì‹ í˜¸.ìˆ˜ìˆ˜ë£Œ;
    }
    
    // ë§¤ë„ ì‹¤í–‰
    if (ë§¤ë„ì‹ í˜¸.ì‹ í˜¸ === 'SELL') {
      ë§¤ë„ì¼ = ê±°ë˜ì¼ì;
      ë§¤ë„ê°€ = ë§¤ë„ì‹ í˜¸.ë§¤ë„ê°€;
      ë§¤ë„ëŸ‰ = ë§¤ë„ì‹ í˜¸.ë§¤ë„ëŸ‰;
      ë§¤ë„ê¸ˆì•¡ = ë§¤ë„ì‹ í˜¸.ë§¤ë„ê¸ˆì•¡;
      ë§¤ë„ìˆ˜ìˆ˜ë£Œ = ë§¤ë„ì‹ í˜¸.ìˆ˜ìˆ˜ë£Œ;
      ë‹¹ì¼ì‹¤í˜„ì†ìµê¸ˆì•¡ = ë§¤ë„ì‹ í˜¸.ì˜ˆìƒìˆ˜ìµ;
      ì†ìµë¥  = (ë‹¹ì¼ì‹¤í˜„ì†ìµê¸ˆì•¡ / (ë§¤ë„ëŸ‰ * í˜„ì¬í‰ë‹¨ê°€)) * 100;
    }
    
    // ë³µë¦¬ ê³„ì‚°
    let ê°±ì‹ ë³µë¦¬ê¸ˆì•¡ = 0;
    if (ë‹¹ì¼ì‹¤í˜„ì†ìµê¸ˆì•¡ !== 0) {
      ê°±ì‹ ë³µë¦¬ê¸ˆì•¡ = ë‹¹ì¼ì‹¤í˜„ì†ìµê¸ˆì•¡ > 0 ?
        ë‹¹ì¼ì‹¤í˜„ì†ìµê¸ˆì•¡ * modeConfig.profitReinvest :  // ì´ìµë³µë¦¬
        ë‹¹ì¼ì‹¤í˜„ì†ìµê¸ˆì•¡ * modeConfig.lossReinvest;     // ì†ì‹¤ë³µë¦¬
    }
    
    const ëˆ„ì ì†ìµ = (ì´ì „ê¸°ë¡?.ëˆ„ì ì†ìµ || 0) + ê°±ì‹ ë³µë¦¬ê¸ˆì•¡;
    
    // í¬íŠ¸í´ë¦¬ì˜¤ ì—…ë°ì´íŠ¸
    const ìƒˆì˜ˆìˆ˜ê¸ˆ = í˜„ì¬ì˜ˆìˆ˜ê¸ˆ - ë§¤ìˆ˜ê¸ˆì•¡ - ë§¤ìˆ˜ìˆ˜ìˆ˜ë£Œ + ë§¤ë„ê¸ˆì•¡ - ë§¤ë„ìˆ˜ìˆ˜ë£Œ;
    const ìƒˆë³´ìœ ëŸ‰ = í˜„ì¬ë³´ìœ ëŸ‰ + ë§¤ìˆ˜ëŸ‰ - ë§¤ë„ëŸ‰;
    
    // í‰ë‹¨ê°€ ì¬ê³„ì‚°
    let ìƒˆí‰ë‹¨ê°€ = 0;
    if (ë§¤ìˆ˜ëŸ‰ > 0 && ìƒˆë³´ìœ ëŸ‰ > 0) {
      const ê¸°ì¡´ë³´ìœ ê°€ì¹˜ = í˜„ì¬ë³´ìœ ëŸ‰ * í˜„ì¬í‰ë‹¨ê°€;
      const ì‹ ê·œë§¤ìˆ˜ê°€ì¹˜ = ë§¤ìˆ˜ëŸ‰ * ë§¤ìˆ˜ê°€;
      ìƒˆí‰ë‹¨ê°€ = (ê¸°ì¡´ë³´ìœ ê°€ì¹˜ + ì‹ ê·œë§¤ìˆ˜ê°€ì¹˜) / ìƒˆë³´ìœ ëŸ‰;
    } else if (ìƒˆë³´ìœ ëŸ‰ > 0) {
      ìƒˆí‰ë‹¨ê°€ = í˜„ì¬í‰ë‹¨ê°€;
    }
    
    const í‰ê°€ê¸ˆ = ìƒˆë³´ìœ ëŸ‰ * ì¢…ê°€;
    const ì´ìì‚° = ìƒˆì˜ˆìˆ˜ê¸ˆ + í‰ê°€ê¸ˆ;
    const ìˆ˜ìµë¥  = ((ì´ìì‚° - ì´ˆê¸°ìê¸ˆ) / ì´ˆê¸°ìê¸ˆ) * 100;
    
    // DD ê³„ì‚°
    const ìµœê³ ìì‚° = Math.max(ì´ìì‚°, ì´ì „ê¸°ë¡?.ìµœê³ ìì‚° || ì´ˆê¸°ìê¸ˆ);
    const DD = ìµœê³ ìì‚° > ì´ìì‚° ? ((ìµœê³ ìì‚° - ì´ìì‚°) / ìµœê³ ìì‚°) * 100 : 0;
    
    const ê±°ë˜ê¸°ë¡: DongpaTrade = {
      ê±°ë˜ì¼ì,
      ì¢…ê°€,
      ë§¤ë§¤ëª¨ë“œ,
      ë³€ë™ë¥ ,
      ë§¤ìˆ˜ì˜ˆì •,
      LOCë§¤ìˆ˜ëª©í‘œ,
      ëª©í‘œëŸ‰,
      ë§¤ìˆ˜ê°€,
      ë§¤ìˆ˜ëŸ‰,
      ë§¤ìˆ˜ê¸ˆì•¡,
      ë§¤ìˆ˜ìˆ˜ìˆ˜ë£Œ,
      ëª©í‘œê°€: ìƒˆí‰ë‹¨ê°€ > 0 ? ìƒˆí‰ë‹¨ê°€ * (1 + modeConfig.sellTarget) : 0,
      MOC: ë§¤ë„ì‹ í˜¸.ì‹ í˜¸ === 'SELL' ? 'SELL' : 'HOLD',
      ë§¤ë„ì¼,
      ë§¤ë„ê°€,
      ë§¤ë„ëŸ‰,
      ë§¤ë„ê¸ˆì•¡,
      ë§¤ë„ìˆ˜ìˆ˜ë£Œ,
      ë‹¹ì¼ì‹¤í˜„ì†ìµê¸ˆì•¡,
      ì†ìµë¥ ,
      ëˆ„ì ì†ìµ,
      ê°±ì‹ ë³µë¦¬ê¸ˆì•¡,
      ìê¸ˆê°±ì‹ ,
      ì‹œë“œ: í˜„ì¬ì‹œë“œ,
      ì¦ì•¡ì…ì¶œê¸ˆ: 0, // ì¶”í›„ êµ¬í˜„ ê°€ëŠ¥
      ì˜ˆìˆ˜ê¸ˆ: ìƒˆì˜ˆìˆ˜ê¸ˆ,
      ë³´ìœ ëŸ‰: ìƒˆë³´ìœ ëŸ‰,
      í‰ê°€ê¸ˆ,
      ì´ìì‚°,
      ìˆ˜ìµë¥ ,
      DD,
      í‰ë‹¨ê°€: ìƒˆí‰ë‹¨ê°€,
      ìµœê³ ìì‚°
    };
    
    return ê±°ë˜ê¸°ë¡;
  }

  // ì—¬ëŸ¬ ì¼ìì˜ ë§¤ë§¤ ê¸°ë¡ ìƒì„±
  public generateTradeHistory(historicalData: MarketData[]): DongpaTrade[] {
    if (!historicalData.length) return [];
    
    const trades: DongpaTrade[] = [];
    let ì´ì „ê¸°ë¡: DongpaTrade | null = null;
    
    historicalData.forEach((dayData) => {
      const ê±°ë˜ê¸°ë¡ = this.generateDailyTradeRecord({
        ê±°ë˜ì¼ì: dayData.date,
        ì¢…ê°€: dayData.price,
        ë§¤ë§¤ëª¨ë“œ: this.config.mode,
        ì´ì „ê¸°ë¡,
        ì´ˆê¸°ìê¸ˆ: this.config.initialCapital,
        ë¶„í• íšŸìˆ˜: this.config.divisions,
        ê°±ì‹ ì£¼ê¸°: 10
      });
      
      trades.push(ê±°ë˜ê¸°ë¡);
      ì´ì „ê¸°ë¡ = ê±°ë˜ê¸°ë¡;
    });
    
    return trades;
  }

  // ì˜¤ëŠ˜ ë§¤ë§¤ ì‹ í˜¸ (ì‹¤ì‹œê°„)
  public getTodayTradingSignals(
    í˜„ì¬ê°€: number, 
    ë³€ë™ë¥ : number, 
    ìµœê·¼ê±°ë˜ê¸°ë¡?: DongpaTrade
  ): TodaySignal {
    const í˜„ì¬ì˜ˆìˆ˜ê¸ˆ = ìµœê·¼ê±°ë˜ê¸°ë¡?.ì˜ˆìˆ˜ê¸ˆ || this.config.initialCapital;
    const í˜„ì¬ë³´ìœ ëŸ‰ = ìµœê·¼ê±°ë˜ê¸°ë¡?.ë³´ìœ ëŸ‰ || 0;
    const í˜„ì¬í‰ë‹¨ê°€ = ìµœê·¼ê±°ë˜ê¸°ë¡?.í‰ë‹¨ê°€ || 0;
    const í˜„ì¬ì‹œë“œ = ìµœê·¼ê±°ë˜ê¸°ë¡?.ì‹œë“œ || this.config.initialCapital;
    
    const ë§¤ìˆ˜ì‹ í˜¸ = this.getTodayBuySignal({
      ì´ˆê¸°ìê¸ˆ: í˜„ì¬ì‹œë“œ,
      ë¶„í• íšŸìˆ˜: this.config.divisions,
      ë§¤ë§¤ëª¨ë“œ: this.config.mode,
      í˜„ì¬ê°€,
      ë³€ë™ë¥ ,
      ì˜ˆìˆ˜ê¸ˆ: í˜„ì¬ì˜ˆìˆ˜ê¸ˆ
    });
    
    const ë§¤ë„ì‹ í˜¸ = this.getTodaySellSignal({
      ë§¤ë§¤ëª¨ë“œ: this.config.mode,
      í˜„ì¬ê°€,
      í‰ë‹¨ê°€: í˜„ì¬í‰ë‹¨ê°€,
      ë³´ìœ ëŸ‰: í˜„ì¬ë³´ìœ ëŸ‰
    });
    
    return { ë§¤ìˆ˜ì‹ í˜¸, ë§¤ë„ì‹ í˜¸ };
  }

  // ì˜ì—…ì¼ ì°¨ì´ ê³„ì‚° (ê°„ë‹¨ ë²„ì „)
  private getBusinessDaysDiff(startDate: string, endDate: string): number {
    const start = new Date(startDate);
    const end = new Date(endDate);
    const diffTime = Math.abs(end.getTime() - start.getTime());
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    // ì£¼ë§ ì œì™¸ (ê°„ë‹¨ ê³„ì‚°)
    const weekdays = Math.floor(diffDays * 5/7);
    return weekdays;
  }

  // ì „ëµ ì •ë³´ ë°˜í™˜
  public getStrategyInfo() {
    const modeConfig = this.getModeConfig(this.config.mode);
    
    const descriptions = {
      safe: {
        name: "ì•ˆì „ëª¨ë“œ",
        description: "ë³´ìˆ˜ì ì¸ ë§¤ë§¤ë¡œ ì•ˆì •ì ì¸ ìˆ˜ìµ ì¶”êµ¬",
        buyCondition: `${modeConfig.buyTarget * 100}% ì´ìƒ í•˜ë½ ì‹œ ë§¤ìˆ˜`,
        sellCondition: `${modeConfig.sellTarget * 100}% ìˆ˜ìµ ì‹œ ë§¤ë„`,
        riskLevel: "ì¤‘ê°„",
        expectedReturn: "ì—° 15-25%",
        maxDrawdown: "20-30%"
      },
      aggressive: {
        name: "ê³µì„¸ëª¨ë“œ", 
        description: "ì ê·¹ì ì¸ ë§¤ë§¤ë¡œ ë†’ì€ ìˆ˜ìµ ì¶”êµ¬",
        buyCondition: `${modeConfig.buyTarget * 100}% ì´ìƒ í•˜ë½ ì‹œ ë§¤ìˆ˜`,
        sellCondition: `${modeConfig.sellTarget * 100}% ìˆ˜ìµ ì‹œ ë§¤ë„`,
        riskLevel: "ë†’ìŒ",
        expectedReturn: "ì—° 30-50%",
        maxDrawdown: "40-60%"
      }
    };
    
    return descriptions[this.config.mode];
  }
}